Cell-DEVS Geographical SEIRDS Pandemic Model
===
Overview
----
This model is an extension of a previous SIRDS model found here:
https://github.com/SimulationEverywhere-Models/Geography-Based-Model

The inital model was based on the Zhong model:
https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7088542/pdf/11430_2009_Article_44.pdf

The model files can be compiled and initialized using the commands found in the `setup.sh` script. The model and data processing tools can be run together using the `run_ontario_phus.sh` scirpt.

Documentation
----
See the `Manual.docx` file located at the root of this repository, the paper titled "GEOGRAPHY BASED CELLULAR COVID-19 DISEASE SPREAD MODEL", and the README files in folders.

Requirements
---
* A C++17 compiler (GCC was used for development)
* cmake
* A copy of this repository
* A copy of Cadmium (master), available at https://github.com/SimulationEverywhere/cadmium
* Python 3, Python packages geopandas, numpy, matplotlib
* Java Runtime Environment

Setup
----
The `setup.sh` script will compile the model and run a data processing tool `gen_phu_cases.py` on the Ontario PHU reported case data, which only needs to be run once.

**Compile using cmake**
1. Navigate to the root directory of the copy of this project
2. Enter the following command `cmake CMakeLists.txt`
3. Execute the make file using the command: make

run_ontario_phus.sh
----
The script `run_ontario_phus.sh` runs a sequence of tools to generate a scenario, simulate the model, and then process the results for visualization. Using this script is the quickest way to run the model and generate results. A description of each step in the script is as follows:

1. Generate a scenario file for the model using the Input_Generator found in Scripts
2. Runs a simulation with the generated scenario
3. Generate SEIRD graphs of the simulation using the Graph_Generator found in Scripts, and save the results to the logs folder. Also generate time series data of the results per region for later analysis.
4. Generate the files required for visulation with the GIS Web Viewer. Uses the Msg_Log_Parser found in Scripts to convert the simulation message log to standard WebViewer format, and saves the result in the GIS_Viewer folder.
5. Compare the simulation time series data generated in step 3 to the reported PHU case data generated upon setup (`gen_phu_cases.py`), saving the result in the logs folder. 

Generating a scenario from geographical data
----
A scenario.json is generated by running generate_ontario_phu_json.py

1. Open a terminal and navigate to Scripts/Input_Generator
2. Edit scenario inputs in the script's input folder folder (default.json, fields.json, infectedCells.json) as desired
3. Run `python generate_ontario_phu_json` and use the results in the output folder


Running a Model
----

To run the model:
1. Create a directory called logs in the root directory of this project (if one does not already exist)
2. Go to the bin folder from the root directory
3. Enter the following command:

`./pandemic-geographical_model <configuration_file_path>/scenario.json [<simulation time>]`

The last parameter is optional. The default is 500.

Viewing Results in GIS Web Viewer V2
---
The most recent version of the GIS Web Viewer can be found at http://206.12.94.204:8080/arslab-web/1.3/app-gis-v2/index.html

Upload a simulation's geojson, messages.log, structure.json, visualization.json to view simulation results. See GIS_Viewer folder README for more details

Installing Cadmium
---

The following commands can be used to get cadmium:

1. git clone https://github.com/SimulationEverywhere/cadmium.git

2. cd cadmium

3. git submodule update --init --recursive

The dependencies for cadmium must also be installed. Refer to the document located at:

http://www.sce.carleton.ca/courses/sysc-5104/lib/exe/fetch.php?media=cadmium.pdf


The location of cadmium must be in the parent folder that holds this project, or the directory directly above.

If the location of this cloned repository has the location of `parentFolder/GeographicalModel`, then the cadmium library should be located in parentFolder.

Alternatively if the location of this cloned repository has the location of `parentFolder/projectsFolder/GeographicalModel`, then the cadmium library should be located in parentFolder.

Downloading geopandas
---
This project uses several python scripts that are dependent on the libraries: geopandas, numpy, and matplotlib. geopandas requires specific versions of many dependent libraries and installing them manually is difficult. The easiest way to download the right packages is to use conda. It is also recommended to install these packages in a seperate conda environment. Attemping to install in conda base may fail.
1. https://www.anaconda.com/products/individual
2. select 64-Bit (x86) Installer (Linux)
3. run the .sh installer, recommended default settings
4. open a terminal and activate conda if not already active
5.  `conda create --name geo_env`
6.  `conda activate geo_env`
7.  `conda install geopandas numpy matplotlib `