Cell-DEVS Geographical SEIRDS Pandemic Model
===
Overview
----
A modified implementation of the Zhong model. The original model that this implementation is based off of can be obtained at:

https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7088542/pdf/11430_2009_Article_44.pdf

This implementation adds additional features to more closely model the real world. See the documentation for more information.

Documentation
----
See the `Manual.docx` file located at the root of this repository, and the README files in folders

Requirements
---
* A C++17 compiler (GCC was used for development)
* A copy of this repository
* A copy of Cadmium (master), available at https://github.com/SimulationEverywhere/cadmium
* Python 3, Python packages geopandas, numpy, matplotlib
* Java Runtime Environment

The following commands can be used to get cadmium:

1. git clone https://github.com/SimulationEverywhere/cadmium.git

2. cd cadmium

3. git submodule update --init --recursive

The dependencies for cadmium must also be installed. Refer to the document located at:

http://www.sce.carleton.ca/courses/sysc-5104/lib/exe/fetch.php?media=cadmium.pdf


The location of cadmium must be in the parent folder that holds this project, or the directory directly above.

If the location of this cloned repository has the location of `parentFolder/GeographicalModel`, then the cadmium library should be located in parentFolder.

Alternatively if the location of this cloned repository has the location of `parentFolder/projectsFolder/GeographicalModel`, then the cadmium library should be located in parentFolder.

Downloading geopandas
---
This project uses several python scripts that are dependent on the libraries: geopandas, numpy, and matplotlib. geopandas requires specific versions of many dependent libraries and installing them manually is difficult. The easiest way to download the right packages is to use conda. It is also recommended to install these packages in a seperate conda environment. Attemping to install in conda base may fail.
1. https://www.anaconda.com/products/individual
2. select 64-Bit (x86) Installer (Linux)
3. run the .sh installer, recommended default settings
4. open a terminal and activate conda if not already active
5.  ```conda create --name geo_env```
6.  ```conda activate geo_env```
7.  ```conda install geopandas numpy matplotlib ```

Compiling the Program
----
**Using CMAKE**
1. Navigate to the root directory of the copy of this project
2. Enter the following command `cmake CMakeLists.txt`
3. Execute the make file using the command: make

Run All Test Script
----
This project contains a number of utilities that can work in sequence. runall_default.sh shows how the utilities are used and sequenced, and can be modified as needed.
runall_default.sh does:

1. Generates a cell space from Ottawa Disemmination area data, initializes infection in a single centrally located cell
2. Runs a simulation
3. Generates SEIRD graphs of the simulation (saved in logs folder)
4. Converts the message log of the simulation into standard web viewer format (messages.log), generates structure.json, and saves the result in "GIS_Viewer/ottawa" folder

The makefile in "Scripts/Input_Generator" must be modified as described in the following section. The environment running the script must include python geopandas. After running runall_default.sh, the 4 files needed by the GIS DEVS Web viewer are generated, and the SEIRD graphs are located in the logs folder. See GIS_Viewer folder README for more details on visualization. 

Generating a scenario from geographical data
----
A scenario.json is generated by running two files: generate_cadmium_json.py and convertScenario, both of which can be run using convertScenario.sh
The makefile in Scripts/Input_Generator that compiles convertScenario must be updated to point to the location of the cadmium includes and json includes on your system. convertScenario.sh does execute a make command, but the paths to these libraries but be correct.

1. Open a terminal and navigate to /Geography-Based-Model/Scripts/Input_Generator
2. Activate python environment (if required on your system)
3. Edit scenario inputs in the Input folder (default.json, fields.json, infectedCell.json) as desired
4. Enter the following command `./convertScenario.sh`

Running a Model
----

To run the model:
1. Create a directory called logs in the root directory of this project (if one does not already exist)
2. Go to the bin folder from the root directory
3. Enter the following command:

`./pandemic-geographical_model <configuration_file_path>/scenario.json [<simulation time>]`

The last parameter is optional. The default is 500.

Viewing Results in GIS Web Viewer V2
---
The most recent version of the GIS Web Viewer can be found at http://206.12.94.204:8080/arslab-web/1.3/app-gis-v2/index.html

Upload a simulation's geojson, messages.log, structure.json, visualization.json to view simulation results. See GIS_Viewer folder README for more details
